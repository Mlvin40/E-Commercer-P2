<div class="card p-3">
  <h5 class="mb-3">Vender producto</h5>

  <form #f="ngForm" (ngSubmit)="guardar(f)" class="row g-3" novalidate>
    <div class="col-md-6">
      <label class="form-label">Nombre</label>
      <input class="form-control" [(ngModel)]="m.nombre" name="nombre" required maxlength="120" />
    </div>

    <!-- Subir archivo (REQUERIDO) -->
    <div class="col-md-6">
      <label class="form-label">Imagen del producto</label>
      <input type="file"
             accept="image/*"
             class="form-control"
             (change)="onFileSelected($event)"
             required />
      <small class="text-muted d-block mt-1">Formatos: JPG/PNG/WebP · Máx. 5MB</small>

      <div *ngIf="previewUrl" class="mt-2">
        <img [src]="previewUrl" alt="preview" class="img-thumbnail" style="max-height: 160px;">
      </div>
    </div>

    <div class="col-12">
      <label class="form-label">Descripción</label>
      <textarea class="form-control" rows="3" [(ngModel)]="m.descripcion" name="descripcion"></textarea>
    </div>

    <div class="col-md-3">
      <label class="form-label">Precio (Q)</label>
      <input type="number" step="0.01" min="0.01" class="form-control"
             [(ngModel)]="m.precio" name="precio" required />
    </div>

    <div class="col-md-3">
      <label class="form-label">Stock</label>
      <input type="number" min="1" class="form-control"
             [(ngModel)]="m.stock" name="stock" required />
    </div>

    <div class="col-md-3">
      <label class="form-label">Estado</label>
      <select class="form-select" [(ngModel)]="m.estado" name="estado" required>
        <option *ngFor="let e of estados" [value]="e">{{ e }}</option>
      </select>
    </div>

    <div class="col-md-3">
      <label class="form-label">Categoría</label>
      <select class="form-select" [(ngModel)]="m.categoria" name="categoria" required>
        <option *ngFor="let c of categorias" [value]="c">{{ c }}</option>
      </select>
    </div>

    <div class="col-12 d-flex gap-2">
      <button class="btn btn-primary" [disabled]="cargando || !archivo || f.invalid">Publicar</button>
      <div class="align-self-center">
        <span *ngIf="exito" class="text-success fw-semibold">{{ exito }}</span>
        <span *ngIf="error" class="text-danger fw-semibold">{{ error }}</span>
      </div>
    </div>
  </form>
</div>
